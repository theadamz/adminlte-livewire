import{e as S,g as k,p as f,j as p,M as i,s,k as a,a as r,r as _,q as y,f as x,_ as h}from"./general-EKVRape8.js";let g=[],m=null,v=null;_dataTableSelectColumn="code";function w(){_dataTable=$("#list_datatable").DataTable({iDisplayLength:-1,bLengthChange:!1,dom:`<'row'
               <'col-sm-6 d-flex align-items-center justify-conten-start'l>
            >
               <'table-responsive'tr>
            <'row'
               <'col-sm-12 col-md-5 d-flex align-items-center justify-content-center justify-content-md-start'i>

            >`,info:!0,scrollX:!0,scrollY:_dataTableScrollY,select:{items:"row",style:"single",className:"bg-warning"},headerCallback:function(e,t,l,d,n){e.getElementsByTagName("th")[0].innerHTML=`
            <div class="form-check">
               <input class="form-check-input datatable-group-checkable" type="checkbox" value="" id="groupCheckable" />
					<label class="form-check-label"></label>
            </div>`},createdRow:function(e,t,l){_dataTableSelectedValues.indexOf(t[_dataTableSelectColumn])>-1&&$(e).addClass("bg-light")},data:g,columns:[{data:"code",width:"30px",orderable:!1,searchable:!1,defaultContent:"",className:"details-control dt-center",render:function(e,t,l,d){return`<div class="d-flex align-items-center">
                           <div class="form-check form-check-custom form-check-sm me-4">
                              <input class="form-check-input datatable-checkable" type="checkbox" value="${e}" ${_dataTableSelectedValues.indexOf(e)>-1?"checked":""} data-index="${d.row}" />
                           </div>
                        </div>`}},{data:"name",orderable:!1},{data:"permissions",orderable:!1,render:function(e,t,l,d){let n="";for(const[u,c]of Object.entries(e))n+=c?`<span class="badge font-weight-normal badge-success mr-1 text-bold">${u}</span>`:`<span class="badge font-weight-normal badge-danger mr-1 text-bold">${u}</span>`;return n}}]}).on("draw.dt",function(e,t){S(_dataTable),_dataTable.columns.adjust()}),k(_dataTable,'input[type="search"]'),document.querySelector("#refresh").addEventListener("click",()=>o())}function D(e){const t=$(this).data("flag"),l=$(this).is(":checked");m[t]=l}function E(){_formValidation=$(document.querySelector("#formInput")).validate({rules:{access_lists:{required:!0}},submitHandler:function(e,t){t.preventDefault(),$(e).valid()&&N()}}),v=$(document.querySelector("#formDuplicate")).validate({rules:{from_role:{required:!0},to_role:{required:!0}},submitHandler:function(e,t){t.preventDefault(),$(e).valid()&&U()}})}function L(){f("#access_lists"),$("#modalFormInput").on("hidden.bs.modal",b),p("#modalFormInput"),f("#role","Select",null,!1),$("#role").on("select2:select",function(e){_dataTable.clear().draw(),$("#addMoreMenu").prop("disabled",!1),o(),$('input[type="search"]').val(null)}),$("#modalFormDuplicate").on("hidden.bs.modal",T),p("#modalFormDuplicate"),f("#from_role"),f("#to_role"),f("#exclude_accesses"),document.querySelector("#saveEditAccess").addEventListener("click",R)}function C(){_permissions.edit&&document.querySelector("#edit").addEventListener("click",()=>{typeof _dataTable.row({selected:!0}).data()>"u"||O(_dataTable.row({selected:!0}).data().code)}),_permissions.delete&&document.querySelector("#delete").addEventListener("click",A)}async function N(){if($("#access_lists").val().length<=0||$("#role").val().trim()==""){i.Notification("Select role and access.");return}s(!0,"#save"),a("#formInput"),_data2Send=new URLSearchParams({role:$("#role").val(),access_lists:JSON.stringify($("#access_lists").val())});const e=await r(`${_baseURL}/configs/accesses`,"POST",_data2Send);if(![201,200].includes(e.status)){i.HtmlNotification(_(e.data),`${e.status} - ${e.statusText}`),s(!1,"#save"),a("#formInput",!1);return}Toast.fire({icon:"success",title:e.statusText,text:e.data.message}),s(!1,"#save"),a("#formInput",!1),b(),o(),$("#modalFormInput").modal("hide")}async function O(e=null){_id=e,a("#list_datatable");const t=await r(`${_baseURL}/configs/accesses/${$("#role").val()}/${_id}`,"GET");if(![200].includes(t.status)){i.HtmlNotification(_(t.data),`${t.status} - ${t.statusText}`),a("#list_datatable",!1);return}b(),_action="edit";const l=t.data.data;$("#editAccess").val(`${l.code} - ${l.name}`);const d=_accesses.find(u=>u.code==l.code);m=l.permissions,$("#editAccessContainer").html(null),$(".check-access").off("click");let n="";for(const[u,c]of Object.entries(d.permissions))n+=`<div class="form-check mx-5">
                            <input class="form-check-input  check-access" type="checkbox" value="true"
                                    id="edit_access_${c}"
                                    name="edit_access_${c}"
                                    data-flag="${c}"
                                    ${l.permissions[c]?"checked":""}/>
                            <label class="form-check-label" for="edit_access_${c}">${c}</label>
                        </div>`;$("#editAccessContainer").html(n),$(".check-access").on("click",D),$("#modalFormEdit").modal("show"),a("#list_datatable",!1)}async function R(){if(y(m)){i.Notification("Please make change before save.");return}s(!0,"#saveEditAccess"),a("#formEdit"),_data2Send=new URLSearchParams({code:_id,permissions:JSON.stringify(m)});const e=await r(`${_baseURL}/configs/accesses/${$("#role").val()}`,"PUT",_data2Send);if(![200].includes(e.status)){i.HtmlNotification(_(e.data),`${e.status} - ${e.statusText}`),s(!1,"#saveEditAccess"),a("#formEdit",!1);return}Toast.fire({icon:"success",title:e.statusText,text:e.data.message}),s(!1,"#saveEditAccess"),a("#formEdit",!1),m=null,o(),$("#modalFormEdit").modal("hide")}async function U(){s(!0,"#saveDuplicate"),a("#formDuplicate"),_data2Send=new URLSearchParams({from_role:$("#from_role").val(),to_role:$("#to_role").val(),exclude_accesses:JSON.stringify($("#exclude_accesses").val())});const e=await r(`${_baseURL}/configs/accesses/duplicate`,"POST",_data2Send);if(![201].includes(e.status)){i.HtmlNotification(_(e.data),`${e.status} - ${e.statusText}`),x(e.data.errors),s(!1,"#saveDuplicate"),a("#formDuplicate",!1);return}Toast.fire({icon:"success",title:e.statusText,text:e.data.message}),_action="create",$("#modalFormDuplicate").modal("hide"),T(),o(),s(!1,"#saveDuplicate"),a("#formDuplicate",!1)}async function A(){if(_dataTableSelectedValues.length<=0){i.HtmlNotification("Select 1 atau more.");return}s(!0,"#delete"),a("#list_datatable"),_data2Send=new URLSearchParams({role:$("#role").val(),id:JSON.stringify(_dataTableSelectedValues)});const e=await r(`${_baseURL}/configs/accesses`,"DELETE",_data2Send);if(![200].includes(e.status)){i.HtmlNotification(_(e.data),`${e.status} - ${e.statusText}`),s(!1,"#delete"),a("#list_datatable",!1);return}Toast.fire({icon:"success",title:e.statusText,text:e.data.message}),h(),o(),s(!1,"#delete"),a("#list_datatable",!1)}function b(){_action="create",_data2Send=null,$("#access_lists").val(null).trigger("change"),_formValidation.resetForm(),$("#formInput")[0].reset()}function T(){_data2Send=null,$("#from_role").val(null).trigger("change"),$("#to_role").val(null).trigger("change"),$("#exclude_accesses").val(null).trigger("change"),v.resetForm(),$("#formDuplicate")[0].reset()}async function o(){if(!$("#role").val())return;s(!0,"#refresh"),a("#list_datatable");const e=await r(`${_baseURL}/configs/accesses/${$("#role").val()}`,"GET",null);if(![200].includes(e.status)){_dataTable.clear().draw(),s(!1,"#refresh"),a("#list_datatable",!1);return}g=e.data.data,_dataTable.clear(),_dataTable.rows.add(e.data.data).search($('input[type="search"]').val()).draw(),h(),s(!1,"#refresh"),a("#list_datatable",!1)}document.addEventListener("DOMContentLoaded",function(){w(),E(),L(),C()});
