import{c as m,e as _,s as n,g as h,j as g,i as o,M as i,k as s,l as v,a as c,r as u,f as p,_ as T}from"./general-EKVRape8.js";let d=null;function w(){_dataTable=$("#list_datatable").DataTable({lengthMenu:[[10,25,50,100,-1],[10,25,50,100,"All"]],pageLength:50,numbers_length:4,searchDelay:500,processing:!0,serverSide:!0,scrollX:!0,stateSave:_dataTableUseState,stateDuration:_dataTableStateDuration,scrollY:_dataTableScrollY,order:[[0,"asc"]],select:{items:"row",style:"single",className:"bg-warning"},headerCallback:function(e,a,t,l,I){e.getElementsByTagName("th")[0].innerHTML=`
            <div class="form-check">
               <input class="form-check-input datatable-group-checkable" type="checkbox" value="" id="groupCheckable" />
					<label class="form-check-label"></label>
            </div>`},createdRow:function(e,a,t){_dataTableSelectedValues.indexOf(a[_dataTableSelectColumn])>-1&&$(e).addClass("bg-light")},ajax:{url:`${_baseURL}/dt/configs/users`,type:"GET",data:function(e){e.is_active=$("#filter_is_active").val(),e.role=$("#filter_role").val()}},columns:[{data:"id",width:"30px",orderable:!1,searchable:!1,render:function(e,a,t,l){return`<div class="form-check">
                               <input class="form-check-input datatable-checkable" type="checkbox" value="${e}" ${_dataTableSelectedValues.indexOf(e)>-1?"checked":""} data-index="${l.row}" />
                                        <label class="form-check-label"></label>
                            </div>`}},{data:"email"},{data:"name"},{data:"role_name",name:"r.name"},{data:"timezone"},{data:"is_active",className:"dt-center",searchable:!1,render:function(e,a,t,l){return m(e)?'<span class="badge font-weight-normal badge-success">Yes</span>':'<span class="badge font-weight-normal badge-warning">No</span>'}}]}).on("xhr.dt",function(e,a,t,l){setTimeout(()=>{_dataTable.columns.adjust()},300)}).on("draw.dt",function(e,a,t,l){_(_dataTable),n(!1,"#refresh")}),h(_dataTable,'input[type="search"]'),document.querySelector("#refresh").addEventListener("click",()=>r(!1)),document.querySelector("#filterReset").addEventListener("click",F),document.querySelector("#formFilter").addEventListener("submit",e=>{e.preventDefault(),r(),$("#modalFormFilter").modal("hide")})}function S(){_formValidation=$(document.querySelector("#formInput")).validate({rules:{email:{required:!0,email:!0},password:{minlength:8},name:{required:!0},role:{required:!0},timezone:{required:!0}},submitHandler:function(e,a){a.preventDefault(),$(e).valid()&&L()}})}function b(){_action==="create"?$("#password").rules("add",{required:!0}):$("#password").rules("remove","required")}function x(){$("#modalFormInput").on("hidden.bs.modal",f),$("#modalFormInput").on("show.bs.modal",b),g("#modalFormInput")}function k(){_permissions.edit&&document.querySelector("#edit").addEventListener("click",()=>{typeof _dataTable.row({selected:!0}).data()>"u"||D(_dataTable.row({selected:!0}).data().id.trim())}),_permissions.delete&&document.querySelector("#delete").addEventListener("click",E)}function y(){o("#password"),o("#email"),o("#name")}async function L(){if(!await i.Confirm("Are you sure?").catch(l=>{l&&console.log(l)}))return;n(!0,"#save"),s("#formInput"),d=`${_baseURL}/configs/users`,_action==="edit"&&(d+=`/${_id}`);const a=_action==="create"?"POST":"PUT";_data2Send=v($("#formInput").serialize(),!1),_data2Send.is_active=$("#is_active").is(":checked");const t=await c(d,a,_data2Send,"application/json");if(![201,200].includes(t.status)){i.HtmlNotification(u(t.data),`${t.status} - ${t.statusText}`),p(t.data.errors),n(!1,"#save"),s("#formInput",!1);return}Toast.fire({icon:"success",title:t.statusText,text:t.data.message}),f(),r(!1),$("#modalFormInput").modal("hide"),n(!1,"#save"),s("#formInput",!1)}async function D(e=null){_id=e,s("#list_datatable");const a=await c(`${_baseURL}/configs/users/${_id}`,"GET");if(![200].includes(a.status)){i.HtmlNotification(u(a.data),`${a.status} - ${a.statusText}`),s("#list_datatable",!1);return}f(),_action="edit";const t=a.data.data;$("#email").val(t.email),$("#name").val(t.name),$('#role option[value="'+t.role_id+'"]').prop("selected",!0).change(),$('#timezone option[value="'+t.timezone+'"]').prop("selected",!0).change(),$("#is_active").prop("checked",m(t.is_active)),b(),$("#modalFormInput").modal("show"),s("#list_datatable",!1)}async function E(){if(_dataTableSelectedValues.length<=0){i.HtmlNotification("Select 1 atau more data.");return}if(!await i.Confirm(`Are you sure want to delete ${_dataTableSelectedValues.length} data?`).catch(t=>{t&&console.log(t)}))return;n(!0,"#delete"),s("#list_datatable"),_data2Send=new URLSearchParams({id:JSON.stringify(_dataTableSelectedValues)});const a=await c(`${_baseURL}/configs/users`,"DELETE",_data2Send);if(![200].includes(a.status)){i.HtmlNotification(u(a.data),`${a.status} - ${a.statusText}`),p(a.data.errors),n(!1,"#delete"),s("#list_datatable",!1);return}Toast.fire({icon:"success",title:a.statusText,text:a.data.message}),T(),r(!1),n(!1,"#delete"),s("#list_datatable",!1)}function r(e=!0){n(!0,"#refresh"),_dataTableResetFilter=!1,_dataTable.ajax.reload(null,e)}function f(){_action="create",_data2Send=null,_formValidation.resetForm(),$("#formInput")[0].reset(),$('#role option[value=""]').prop("selected",!0).change(),$('#timezone option[value=""]').prop("selected",!0).change(),$("#is_active").prop("checked",!0)}function F(){$('#filter_is_active option[value=""]').prop("selected",!0).change(),$('#filter_role option[value=""]').prop("selected",!0).change(),$("#formFilter")[0].reset()}document.addEventListener("DOMContentLoaded",function(){w(),S(),x(),y(),k()});
