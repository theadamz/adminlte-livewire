import{s as r}from"./application-CIPDdUt4.js";import{e as k,g as x,t as b,p as h,j as g,M as i,s,k as a,a as o,r as _,q as w,f as D,_ as v}from"./general-EKVRape8.js";let S=[],m=null,T=null;_dataTableSelectColumn="code";function E(){_dataTable=$("#list_datatable").DataTable({iDisplayLength:-1,bLengthChange:!1,dom:`<'row'
               <'col-sm-6 d-flex align-items-center justify-conten-start'l>
            >
               <'table-responsive'tr>
            <'row'
               <'col-sm-12 col-md-5 d-flex align-items-center justify-content-center justify-content-md-start'i>

            >`,info:!0,scrollX:!0,scrollY:_dataTableScrollY,select:{items:"row",style:"single",className:"bg-warning"},headerCallback:function(e,t,l,u,n){e.getElementsByTagName("th")[0].innerHTML=`
            <div class="form-check">
               <input class="form-check-input datatable-group-checkable" type="checkbox" value="" id="groupCheckable" />
					<label class="form-check-label"></label>
            </div>`},createdRow:function(e,t,l){_dataTableSelectedValues.indexOf(t[_dataTableSelectColumn])>-1&&$(e).addClass("bg-light")},data:S,columns:[{data:"code",width:"30px",orderable:!1,searchable:!1,defaultContent:"",className:"details-control dt-center",render:function(e,t,l,u){return`<div class="d-flex align-items-center">
                           <div class="form-check form-check-custom form-check-sm me-4">
                              <input class="form-check-input datatable-checkable" type="checkbox" value="${e}" ${_dataTableSelectedValues.indexOf(e)>-1?"checked":""} data-index="${u.row}" />
                           </div>
                        </div>`}},{data:"name",orderable:!1},{data:"permissions",orderable:!1,render:function(e,t,l,u){let n="";for(const[f,c]of Object.entries(e))n+=c?`<span class="badge font-weight-normal badge-success mr-1 text-bold">${f}</span>`:`<span class="badge font-weight-normal badge-danger mr-1 text-bold">${f}</span>`;return n}}]}).on("draw.dt",function(e,t){k(_dataTable),_dataTable.columns.adjust()}),x(_dataTable,'input[type="search"]'),document.querySelector("#refresh").addEventListener("click",()=>d())}function L(e){const t=$(this).data("flag"),l=$(this).is(":checked");m[t]=l}function R(){_formValidation=$(document.querySelector("#formInput")).validate({rules:{access_lists:{required:!0}},submitHandler:function(e,t){t.preventDefault(),$(e).valid()&&N()}}),T=$(document.querySelector("#formDuplicate")).validate({rules:{from_user:{required:!0},from_user:{required:!0}},submitHandler:function(e,t){t.preventDefault(),$(e).valid()&&F()}})}function C(){b("#user","Select",`${_baseURL}/options/configs/users`,null,r.userResult,r.userSelection,!1),h("#access_lists"),$("#modalFormInput").on("hidden.bs.modal",p),g("#modalFormInput"),$("#user").on("select2:select",function(e){_dataTable.clear().draw(),$("#addMoreMenu").prop("disabled",!1),d(),$('input[type="search"]').val(null)}),$("#modalFormDuplicate").on("hidden.bs.modal",y),g("#modalFormDuplicate"),b("#from_user","Select",`${_baseURL}/options/configs/users`,null,r.userResult,r.userSelection,!1),b("#to_user","Select",`${_baseURL}/options/configs/users`,null,r.userResult,r.userSelection,!1),h("#exclude_accesses"),document.querySelector("#saveEditAccess").addEventListener("click",A)}function U(){_permissions.edit&&document.querySelector("#edit").addEventListener("click",()=>{typeof _dataTable.row({selected:!0}).data()>"u"||O(_dataTable.row({selected:!0}).data().code)}),_permissions.delete&&document.querySelector("#delete").addEventListener("click",I)}async function N(){if($("#access_lists").val().length<=0||!$("#user").val()){i.Notification("Select user and access.");return}s(!0,"#save"),a("#formInput"),_data2Send=new URLSearchParams({user:$("#user").val(),access_lists:JSON.stringify($("#access_lists").val())});const e=await o(`${_baseURL}/configs/user-accesses`,"POST",_data2Send);if(![201,200].includes(e.status)){i.HtmlNotification(_(e.data),`${e.status} - ${e.statusText}`),s(!1,"#save"),a("#formInput",!1);return}Toast.fire({icon:"success",title:e.statusText,text:e.data.message}),s(!1,"#save"),a("#formInput",!1),p(),d(),$("#modalFormInput").modal("hide")}async function O(e=null){_id=e,a("#list_datatable");const t=await o(`${_baseURL}/configs/user-accesses/${$("#user").val()}/${_id}`,"GET");if(![200].includes(t.status)){i.HtmlNotification(_(t.data),`${t.status} - ${t.statusText}`),a("#list_datatable",!1);return}p(),_action="edit";const l=t.data.data;$("#editAccess").val(`${l.code} - ${l.name}`);const u=_accesses.find(f=>f.code==l.code);m=l.permissions,$("#editAccessContainer").html(null),$(".check-access").off("click");let n="";for(const[f,c]of Object.entries(u.permissions))n+=`<div class="form-check mx-5">
                            <input class="form-check-input  check-access" type="checkbox" value="true"
                                    id="edit_access_${c}"
                                    name="edit_access_${c}"
                                    data-flag="${c}"
                                    ${l.permissions[c]?"checked":""}/>
                            <label class="form-check-label" for="edit_access_${c}">${c}</label>
                        </div>`;$("#editAccessContainer").html(n),$(".check-access").on("click",L),$("#modalFormEdit").modal("show"),a("#list_datatable",!1)}async function A(){if(w(m)){i.Notification("Please make change before save.");return}s(!0,"#saveEditAccess"),a("#formEdit"),_data2Send=new URLSearchParams({code:_id,permissions:JSON.stringify(m)});const e=await o(`${_baseURL}/configs/user-accesses/${$("#user").val()}`,"PUT",_data2Send);if(![200].includes(e.status)){i.HtmlNotification(_(e.data),`${e.status} - ${e.statusText}`),s(!1,"#saveEditAccess"),a("#formEdit",!1);return}Toast.fire({icon:"success",title:e.statusText,text:e.data.message}),s(!1,"#saveEditAccess"),a("#formEdit",!1),m=null,d(),$("#modalFormEdit").modal("hide")}async function F(){s(!0,"#saveDuplicate"),a("#formDuplicate"),_data2Send=new URLSearchParams({from_user:$("#from_user").val(),to_user:$("#to_user").val(),exclude_accesses:JSON.stringify($("#exclude_accesses").val())});const e=await o(`${_baseURL}/configs/user-accesses/duplicate`,"POST",_data2Send);if(![201].includes(e.status)){i.HtmlNotification(_(e.data),`${e.status} - ${e.statusText}`),D(e.data.errors),s(!1,"#saveDuplicate"),a("#formDuplicate",!1);return}Toast.fire({icon:"success",title:e.statusText,text:e.data.message}),_action="create",$("#modalFormDuplicate").modal("hide"),y(),$("#user").val()&&d(),s(!1,"#saveDuplicate"),a("#formDuplicate",!1)}async function I(){if(_dataTableSelectedValues.length<=0){i.HtmlNotification("Select 1 atau more.");return}s(!0,"#delete"),a("#list_datatable"),_data2Send=new URLSearchParams({user:$("#user").val(),id:JSON.stringify(_dataTableSelectedValues)});const e=await o(`${_baseURL}/configs/user-accesses`,"DELETE",_data2Send);if(![200].includes(e.status)){i.HtmlNotification(_(e.data),`${e.status} - ${e.statusText}`),s(!1,"#delete"),a("#list_datatable",!1);return}Toast.fire({icon:"success",title:e.statusText,text:e.data.message}),v(),d(),s(!1,"#delete"),a("#list_datatable",!1)}function p(){_action="create",_data2Send=null,$("#access_lists").val(null).trigger("change"),_formValidation.resetForm(),$("#formInput")[0].reset()}function y(){_data2Send=null,$("#from_user").val(null).empty().trigger("change"),$("#to_user").val(null).empty().trigger("change"),$("#exclude_accesses").val(null).trigger("change"),T.resetForm(),$("#formDuplicate")[0].reset()}async function d(){if(!$("#user").val())return;s(!0,"#refresh"),a("#list_datatable");const e=await o(`${_baseURL}/configs/user-accesses/${$("#user").val()}`,"GET",null);if(![200].includes(e.status)){_dataTable.clear().draw(),s(!1,"#refresh"),a("#list_datatable",!1);return}S=e.data.data,_dataTable.clear(),_dataTable.rows.add(e.data.data).search($('input[type="search"]').val()).draw(),v(),s(!1,"#refresh"),a("#list_datatable",!1)}document.addEventListener("DOMContentLoaded",function(){E(),R(),C(),U()});
